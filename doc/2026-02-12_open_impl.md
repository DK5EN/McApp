# Schema v4 — Open Implementation Items

_Status after deployment on 2026-02-12_

## Fully Complete (deployed and verified on Pi)

- Schema v4 migration (14 message columns, 8 telemetry columns, telemetry table, indexes, backfill)
- `conversation_key` for fast DM queries (replaces UNION ALL + LIKE)
- Send success tracking (binary ACKs → `send_success` flag, no more ACK rows stored)
- Receipt confirmation tracking (`echo_id` extraction, inline `:ack` matching → `acked` flag)
- `_build_message_dict()` replacing raw_json reads on all query paths
- BLE telemetry parsing (`T#` APRS format) + UDP telemetry routing
- `battery_level` → `batt` fix in `parse_aprs_position()`

## Open / Deferred

### 1. Phase 2: Drop `raw_json` column (schema v5)

Explicitly deferred 30 days per plan. Once all old messages have expired through normal retention pruning, `raw_json` can be removed.

### 2. ACK match rate was 0/1456

During migration, none of the existing ACK rows matched original messages by `msg_id`. Likely because the original sent messages were already pruned (30-day retention) or the hex `ack_id` format in binary ACK packets doesn't align with `msg_id` stored on outgoing messages. Going forward, new binary ACKs will correctly set `send_success = 1` on the matching message. The 1456 orphan ACK rows were cleaned up regardless.

### 3. Telemetry data not yet flowing

The `telemetry` table is empty. This is expected — it requires MeshCom nodes with environment sensors (temperature, humidity, pressure) to transmit either `T#` APRS beacons (BLE path) or `type: "tele"` packets (UDP path). The code is ready; it just needs sensor-equipped nodes on the network.

### 4. Frontend updates (separate repo)

The Vue.js frontend (`webapp` repo) could be updated to:

- Display `send_success` and `acked` status indicators on messages
- Remove the client-side `:ack` matching JavaScript (now server-side)
- Show telemetry data from `station_positions` in the position view
- Leverage `conversation_key` in API calls (backend already handles this transparently)

### 5. `load_dump()` not updated

The JSON dump import method still uses the old column set. Low priority since it's a legacy/debug feature.

## Notes

- Items 1 and 3 are "wait and see" — no action needed now
- Item 2 will self-verify as new ACKs arrive
- Items 4–5 are optional follow-ups outside the scope of the backend plan
