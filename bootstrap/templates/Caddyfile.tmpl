# MCProxy Caddy configuration
# Generated by mcproxy.sh bootstrap
# Hostname: {{HOSTNAME}}

# Global options
{
    # Use internal CA for local TLS
    local_certs
    auto_https disable_redirects
}

# Main HTTPS site
https://{{HOSTNAME}}.local {
    # Serve static webapp
    handle /webapp/* {
        root * /var/www/html
        file_server
    }

    # Root certificate download
    handle /root.crt {
        root * /var/lib/caddy/.local/share/caddy/pki/authorities/local
        rewrite * /root.crt
        file_server
    }

    # Default: redirect to webapp
    handle {
        redir /webapp/ permanent
    }
}

# WebSocket proxy (separate port for WSS)
https://{{HOSTNAME}}.local:2981 {
    reverse_proxy localhost:2980
}
